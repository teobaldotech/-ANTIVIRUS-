<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Antiv√≠rus Simples</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f4f4f4; padding: 20px; }
    h1, h2, h3 { color: #333; }
    input, button { margin: 5px 0; padding: 8px; }
    .safe { color: green; font-weight: bold; }
    .danger { color: red; font-weight: bold; }
    .card, li { background: #fff; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; }
    ul { list-style: none; padding: 0; }
    #listaPalavras li:hover { background: #eee; cursor: pointer; }
    #resultados, #historico, #listaPalavras { margin-top: 20px; }
  </style>
</head>
<body>

  <h1>üõ°Ô∏è Antiv√≠rus Simples</h1>
  
  <p>üìÇ Selecione arquivos de texto para escanear:</p>
  <input type="file" id="fileInput" accept=".txt" multiple>
  <button onclick="escanearArquivos()">Escanear</button>

  <h2>‚ö†Ô∏è Palavras Suspeitas Personalizadas</h2>
  <input type="text" id="novaPalavra" placeholder="Adicionar palavra (ex: spyware)">
  <button onclick="adicionarPalavra()">Adicionar</button>
  <ul id="listaPalavras"></ul>

  <h2>üîç Resultados:</h2>
  <div id="resultados"></div>

  <div id="historico">
    <h3>üóÇÔ∏è Hist√≥rico de Escaneamentos</h3>
    <ul id="listaHistorico"></ul>
    <button onclick="limparHistorico()">üßπ Limpar Hist√≥rico</button>
  </div>

  <script>
    // Utilidades
    function normalizar(texto) {
      return texto.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
    }

    function obterPalavrasSuspeitas() {
      return JSON.parse(localStorage.getItem("palavrasSuspeitas")) || ["virus", "trojan", "malware", "worm", "hacker"];
    }

    function salvarPalavrasSuspeitas(palavras) {
      localStorage.setItem("palavrasSuspeitas", JSON.stringify(palavras));
    }

    function adicionarPalavra() {
      const input = document.getElementById("novaPalavra");
      const palavra = input.value.trim().toLowerCase();
      if (!palavra) return;

      let palavras = obterPalavrasSuspeitas();
      if (!palavras.includes(palavra)) {
        palavras.push(palavra);
        salvarPalavrasSuspeitas(palavras);
        mostrarListaPalavras();
        input.value = "";
      }
    }

    function mostrarListaPalavras() {
      const lista = document.getElementById("listaPalavras");
      const palavras = obterPalavrasSuspeitas();
      lista.innerHTML = "";

      palavras.forEach(palavra => {
        const li = document.createElement("li");
        li.textContent = palavra;
        li.title = "Clique para remover";
        li.onclick = () => {
          if (confirm(`Remover "${palavra}" da lista negra?`)) {
            const novaLista = palavras.filter(p => p !== palavra);
            salvarPalavrasSuspeitas(novaLista);
            mostrarListaPalavras();
          }
        };
        lista.appendChild(li);
      });
    }

    function escanearArquivos() {
      const input = document.getElementById('fileInput');
      const resultados = document.getElementById('resultados');
      resultados.innerHTML = "";

      if (!input.files.length) {
        resultados.innerHTML = "<p class='danger'>Nenhum arquivo selecionado.</p>";
        return;
      }

      const palavrasSuspeitas = obterPalavrasSuspeitas();

      Array.from(input.files).forEach(arquivo => {
        const leitor = new FileReader();

        leitor.onload = function(e) {
          const conteudoOriginal = e.target.result;
          const conteudo = normalizar(conteudoOriginal);

          const encontradas = palavrasSuspeitas.filter(p => conteudo.includes(p));
          const urlsEncontradas = (conteudoOriginal.match(/https?:\/\/[^\s]+/g) || []);
          
          const risco = (encontradas.length + urlsEncontradas.length) === 0
            ? "Baixo"
            : (encontradas.length + urlsEncontradas.length) <= 3
              ? "M√©dio" : "Alto";

          const resultado = document.createElement("div");
          resultado.className = "card";
          resultado.innerHTML = `
            <strong>${arquivo.name}</strong><br>
            Palavras suspeitas: ${encontradas.join(', ') || 'Nenhuma'}<br>
            URLs encontradas: ${urlsEncontradas.length}<br>
            Risco: <span class="${risco === 'Baixo' ? 'safe' : 'danger'}">${risco}</span>
          `;

          resultados.appendChild(resultado);
          salvarNoHistorico(arquivo.name, encontradas, urlsEncontradas, risco);
          mostrarHistorico();
        };

        leitor.readAsText(arquivo);
      });
    }

    function salvarNoHistorico(nomeArquivo, palavras, urls, risco) {
      const historico = JSON.parse(localStorage.getItem("historico")) || [];
      historico.push({
        nome: nomeArquivo,
        data: new Date().toLocaleString(),
        palavras,
        urls,
        risco
      });
      localStorage.setItem("historico", JSON.stringify(historico));
    }

    function mostrarHistorico() {
      const lista = document.getElementById("listaHistorico");
      const historico = JSON.parse(localStorage.getItem("historico")) || [];
      lista.innerHTML = "";

      historico.slice().reverse().forEach(item => {
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>${item.nome}</strong> - ${item.data}<br>
          Risco: <span class="${item.risco === 'Baixo' ? 'safe' : 'danger'}">${item.risco}</span><br>
          Palavras: ${item.palavras.join(', ') || 'Nenhuma'}<br>
          URLs: ${item.urls.length}
        `;
        lista.appendChild(li);
      });
    }

    function limparHistorico() {
      localStorage.removeItem("historico");
      mostrarHistorico();
    }

    // Inicializa√ß√£o
    window.onload = () => {
      mostrarListaPalavras();
      mostrarHistorico();
    };
  </script>

</body>
</html>